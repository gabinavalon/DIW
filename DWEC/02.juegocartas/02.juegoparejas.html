<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Juego de cartas en el que debes emparejar cartas de MTG fallando lo menos posible">
    <title>Juego de Memoria MTG</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
        integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link rel="apple-touch-icon" sizes="57x57" href="favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <img src="favicon\android-icon-192x192.png" alt="logo">
        <h1 class="ES">Juego de Memoria MTG</h1>
        <h1 class="EN">MTG Memory Game</h1>
    </header>



    <div class="tablas">
        <div class="puntuacion">
            <table>
                <tr>
                    <th rowspan="2">
                        <span id="usu"></span>
                    </th>
                    <th class="ES">
                        <u>Puntuación</u>
                    </th>
                    <th class="EN">
                        <u>Score</u>
                    </th>
                    <th>
                        <i class="fas fa-trophy"></i>
                    </th>
                    <th class="ES">
                        <u>Errores</u>
                    </th>
                    <th class="EN">
                        <u>Mistakes</u>
                    </th>
                    <th>
                        <i class="fas fa-skull"></i>
                    </th>
                </tr>
                <tr>
                    <td colspan="2"><input type="text" value="0" id="marcador" disabled size="3"></td>
                    <td colspan="2"><input type="text" value="0" id="errores" disabled size="3"></td>
                </tr>

            </table>
        </div>

        <div class="ranking" id="ranking">
            <table>
                <tr>
                    <th class="ES"><u>Mejor jugadorx</u> </th>
                    <th class="EN"><u>Best player</u> </th>
                    <th class="ES"><u>Errores</u> </th>
                    <th class="EN"><u>Mistakes</u></th>
                </tr>
                <tr>
                    <td id="winner">¿?¿?¿?</td>

                    <td><input type="text" value="100" id="erroresGanador" disabled size="3"></td>

                </tr>
            </table>

        </div>

        <div class="idioma">
            <table>
                <tr>
                    <th colspan="2" class="ES"><u>Idioma</u> </th>
                    <th colspan="2" class="EN"><u>Language</u> </th>
                </tr>
                <tr>
                    <td><button id="btnES">ES</button></td>

                    <td><button id="btnEN">EN</button></td>
                </tr>
            </table>
        </div>
    </div>

    <div class="mensajes ES" id="mensajesES">
        (Los avisos irán aquí)
    </div>
    <div class="mensajes EN" id="mensajesEN">
        (Alerts will appear here)
    </div>

    <div class="juego">



        <div class="contenedorCartas">

            <div class="cartas" id="carta1"></div>
            <div class="cartas" id="carta2"></div>
            <div class="cartas" id="carta3"></div>
            <div class="cartas" id="carta4"></div>
            <div class="cartas" id="carta5"></div>
            <div class="cartas" id="carta6"></div>
            <div class="cartas" id="carta7"></div>
            <div class="cartas" id="carta8"></div>
            <div class="cartas" id="carta9"></div>
            <div class="cartas" id="carta10"></div>
            <div class="cartas" id="carta11"></div>
            <div class="cartas" id="carta12"></div>

        </div>

        <div class="informacion ES">
            Para jugar solo tienes que hacer click en cualquier carta para darle la vuelta. <br> <br>
            Después, haz click en otra carta, si son iguales, habrás consegido un punto,
            si son distintas, volverán a darse la vuelta. <br><br>
            ¡Tendrás que recordar su posición! <br><br>
            El juego termina cuando emparejas todas las cartas. <br> <br>
            ¡Intenta terminar con el menor número de fallos! <br><br><br>
            <img src="favicon\android-icon-72x72.png" alt="logo"> <br><br>
            Lorem ipsum dolor sit amet consectetur, adipisicing elit. Tempore vel id dicta delectus non earum ducimus
            repellat, quae officia iure repellendus consectetur culpa, nesciunt at provident fugiat facilis amet modi.
            <br><br>
            Lorem ipsum dolor sit amet consectetur adipisicing elit. Facilis aperiam itaque architecto cumque. Neque
            provident, minus labore magni rem reiciendis repellat error aliquam enim! Dolor fuga accusamus architecto
            dolorem? Temporibus?
            <br><br>
            Lorem ipsum dolor sit amet consectetur adipisicing elit. Rerum unde cupiditate doloribus minima itaque
            sapiente corporis incidunt, consequuntur quasi. Ullam consequuntur labore rerum fugit aliquid a culpa
            corporis totam molestiae.
        </div>
        <div class="informacion EN">
            To play, you have to click in any card to flip it <br> <br>
            Then, you can click any other card, if both cards are the same, you will get a pint,
            and if they are different, they wull flip again <br><br>
            You have to remember their position! <br><br>
            The game will end when you match all the cards. <br><br>
            Try to finish with fewer mistakes as possible! <br><br><br>
            <img src="favicon\android-icon-72x72.png" alt="logo"> <br><br>
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Est iure saepe, illum fuga vitae quo molestias
            dicta officiis excepturi ipsum autem officia fugit incidunt eligendi, ea ex deleniti voluptas ab?
            <br><br>
            Lorem, ipsum dolor sit amet consectetur adipisicing elit. Architecto ratione debitis, tempora quae commodi
            voluptatum veniam voluptate aspernatur non, asperiores ex laboriosam cumque nulla aliquam inventore magni?
            Sed, eos fugit!
            <br><br>
            Lorem ipsum dolor sit amet consectetur adipisicing elit. Illo vel voluptas unde distinctio, laborum
            molestias ipsum error repudiandae suscipit veniam aut exercitationem impedit quaerat velit. Illum cupiditate
            eveniet possimus reprehenderit!
        </div>
    </div>

    <div class="footer">
        Gabriel Navalón Soriano --- MTGMemoryGame
    </div>


    <script>

        //Recoger el nombre de usuario y reorganizar las cartas cada vez que se reinica la página
        var usuario;

        window.addEventListener('load', function () {
            arrSrc.sort(function () { return Math.random() - 0.5 });
            var nomUsuario = document.getElementById('usu');
            usuario = prompt("Escribe tu nombre de usuario: ");
            nomUsuario.innerHTML = usuario;
        });

        //Mensajes dinámicos
        mensajesES = document.getElementById('mensajesES');
        mensajesEN = document.getElementById('mensajesEN');

        //Ranking
        var usuGanador = document.getElementById('winner');
        var fallosGanador = document.getElementById('erroresGanador');

        //MArcador y errores
        let marcador = document.getElementById('marcador');
        let errores = document.getElementById('errores');


        //Si tenemos info de ganador guardada la mostramos en su respectiva tabla

        if (localStorage.getItem('ganador')) {
            let cganador = localStorage.getItem('ganador');
            setGanador(cganador);
        }
        /*
        if (getCookie('ganador')) {
            let cganador = getCookie('ganador');

            setGanador(cganador);
        }*/

        // Cartas HTML
        let carta1 = document.getElementById('carta1');
        let carta2 = document.getElementById('carta2');
        let carta3 = document.getElementById('carta3');
        let carta4 = document.getElementById('carta4');
        let carta5 = document.getElementById('carta5');
        let carta6 = document.getElementById('carta6');
        let carta7 = document.getElementById('carta7');
        let carta8 = document.getElementById('carta8');
        let carta9 = document.getElementById('carta9');
        let carta10 = document.getElementById('carta10');
        let carta11 = document.getElementById('carta11');
        let carta12 = document.getElementById('carta12');

        //Array de las cartas
        let arrCartas = [
            carta1, carta2, carta3, carta4, carta5, carta6,
            carta7, carta8, carta9, carta10, carta11, carta12
        ];

        //Array con las url de las cartas 
        let arrSrc = [
            "url(mtg1.jpg)", "url(mtg2.jpg)", "url(mtg3.jpg)",
            "url(mtg4.jpg)", "url(mtg5.jpg)", "url(mtg6.jpg)",
            "url(mtg1.jpg)", "url(mtg2.jpg)", "url(mtg3.jpg)",
            "url(mtg4.jpg)", "url(mtg5.jpg)", "url(mtg6.jpg)"
        ];

   
        //Variables con las que se trabajará las selecciones y puntos
        let sel1 = '';
        let sel2 = '';
        let puntuacion = 0;
        let contadorErr = 0;

        //Añadir la función de dar la vuelta a la carta
        //Se asigna al azar una posición del array de las URL a cada una de las cartas
        for (let i = 0; i < arrCartas.length; i++) {
            const carta = arrCartas[i];
            carta.addEventListener('click', function () {
                carta.style.backgroundImage = arrSrc[i];
            })
        }

        arrCartas.forEach(element => { //Por cada carta, añadimos la función de comparar si se hace click sobre estas

            element.addEventListener('click', function comparar(e) {

                if (sel1 == '') { //Sel son las variables que harán referencia al primer click y segungo, si el primer click no tiene valor, se lo asignamos
                    sel1 = e.target; // Esto asignaría el primer movimiento

                } else {
                    if (sel1 != e.target) { // Si el segundo movimiento no es  igual al primero, comparamos

                   
                        sel2 = e.target;
                        if (sel1.style.backgroundImage === sel2.style.backgroundImage) {
                            
                            
                            //Vamos a usar la visibilidad como variable para comprobar si hemos acertado o no en una carta  
                            
                            sel1.style.visibility = 'inherit';
                            sel2.style.visibility = 'inherit';
                            
                            //Limpiamos las variables de seleccion y añadimos un punto
                            sel1 = '';
                            sel2 = '';

                            puntuacion++;
                            mensajesEN.innerHTML = "Nice!";
                            mensajesES.innerHTML = "¡Muy bien!";
                            marcador.value = puntuacion;
                            //Ganar el Juego
                            if (marcador.value == 6) {
                                alert("¡Has ganado! Errores: " + contadorErr);
                                //Si se llega a los 6 aciertos, se compara el jugador anterior con este, si este tien menos fallos, será el que aparezca en la cookie
                                if (fallosGanador.value >= contadorErr) {
                                    
                                    let usuarioErrores = (usuario + "&" + contadorErr);

                                    localStorage.setItem('ganador', usuarioErrores.toString())
                                }

                                

                                //setCookie("ganador", usuarioErrores.toString(), 7);

                                location.reload();
                            }
                        } else {
                            //Error
                            setTimeout(() => { //Con el set timeout nos da tiempo a ver la carta volteada cuando fallamos

                                if (sel1.style.visibility == 'inherit') { //Significa que la primera que hemos elegido, ya ha sido dada la vuelta
                                    sel2.style.backgroundImage = 'url(dorso.jpg)';
                             
                                } else if (sel2.style.visibility == 'inherit') { // La segunda que hemos elegido ya ha sido dada la vuelta
                                    
                                    sel1.style.backgroundImage = 'url(dorso.jpg)';
                                  
                                } else { //Error normal
                                    sel1.style.backgroundImage = 'url(dorso.jpg)';
                                    sel2.style.backgroundImage = 'url(dorso.jpg)';
                             
                                }

                                sel1 = '';
                                sel2 = '';

                                mensajesEN.innerHTML = "Fail! Try again";
                                mensajesES.innerHTML = "¡Error! Prueba otra vez";

                                contadorErr++;
                                errores.value = contadorErr;


                            }, 500);

                        }
                    }
                }

            })
        });

        /*   FUNCIONES GET Y SET COOKIE
                function getCookie(name) {
                    var cookieArr = document.cookie.split(";");
        
                    for (var i = 0; i < cookieArr.length; i++) {
                        var cookiePair = cookieArr[i].split("=");
        
                        if (name == cookiePair[0].trim()) {
        
                            return decodeURIComponent(cookiePair[1]);
                        }
                    }
                    return null;
                }
        
                function setCookie(cname, cvalue, exdays) {
                    const d = new Date();
                    d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
                    let expires = "expires=" + d.toUTCString();
                    document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
                }
        */
        function setGanador(c) {

            var arrGanador = c.split('&');

            fallosGanador.value = arrGanador[1];
            usuGanador.innerHTML = arrGanador[0];

        }

        //Cambios de idioma

        let btnES = document.getElementById('btnES');
        let btnEN = document.getElementById('btnEN');


        let idiomaActual = '';
        let pagEN = document.getElementsByClassName("EN"); //Recogemos todos los elementos en español o inglés
        let pagES = document.getElementsByClassName("ES");

        // Por defecto ponemos la página en español  
        if (!localStorage.getItem('idioma')) {
            idiomaES();
            mensajesES.innerHTML = 'Bienvenido';
        }

        if (localStorage.idioma == 'ES') { //Cambio de idioma según el localstorage
            idiomaES();
        }

        if (localStorage.idioma == 'EN') {
            idiomaEN();
        }


        btnES.addEventListener('click', idiomaES); //Cambio de idioma con el botón de idioma


        btnEN.addEventListener('click', idiomaEN);


        function idiomaES() {
            if (idiomaActual == 'ES') {
                mensajesES.innerHTML = 'La página ya se encuentra en Español';
            } else {
                for (i = 0; i < pagEN.length; i++) {
                    pagEN[i].classList.add('invisible');
                }
                for (i = 0; i < pagES.length; i++) {
                    pagES[i].classList.remove('invisible');
                }

                mensajesES.innerHTML = 'Idioma: Español';
                localStorage.setItem('idioma', 'ES');
                idiomaActual = "ES";
            }

        }

        function idiomaEN() {
            if (idiomaActual == 'EN') {

                mensajesEN.innerHTML = 'This page already is in English';
            } else {
                for (i = 0; i < pagEN.length; i++) {
                    pagEN[i].classList.remove('invisible');
                }
                for (i = 0; i < pagES.length; i++) {
                    pagES[i].classList.add('invisible');
                }

                mensajesEN.innerHTML = 'Language: English';
                localStorage.setItem('idioma', 'EN');
                idiomaActual = 'EN';
            }

        }


    </script>

</body>

</html>